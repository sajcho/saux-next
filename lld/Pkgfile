# Description:	LLVM - Low Level Virtual Machine
# URL:		http://llvm.org/
# Maintainer:	sajcho, saux dot aarch64 at gmail dot com
# Depends on:	llvm-toolchain

name=lld
_realname=llvm-project
version=17.0.0rc4
release=0
source=(https://github.com/llvm/${_realname}/releases/download/llvmorg-17.0.0-rc4/${_realname}-${version}.src.tar.xz)

build() {
	cd ${_realname}-${version}.src

	mkdir build
	cd build

	export CC="clang"
	export CXX="clang++"
	export CFLAGS="${CFLAGS/ -flto=auto -ffat-lto-objects/ -w}"
	export CXXFLAGS="${CXXFLAGS/ -flto=auto -ffat-lto-objects/ -w}"

	cmake -G Ninja \
		-DCMAKE_BUILD_TYPE="Release" \
		-DCMAKE_INSTALL_PREFIX="/usr " \
		-DCMAKE_SKIP_INSTALL_RPATH=ON \
		-DBUILD_SHARED_LIBS=ON \
		-DLLD_BUILT_STANDALONE=ON \
		-Wno-dev \
		../lld

	ninja

	DESTDIR=$PKG ninja install
}
